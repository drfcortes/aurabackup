---
import Layout from '../layouts/Layout.astro';
---

<Layout>
    <main class="p-8 max-w-4xl mx-auto text-aura-deep dark:text-aura-cream">
        <h1 class="text-3xl font-bold text-aura-green dark:text-aura-yellow mb-6">Find an AURA Block</h1>

        <section class="prose prose-lg max-w-none text-left mb-8">
            <p>
                Enter the <strong>AURA Block UID</strong> or your <strong>email</strong> to view its metadata and traceability record.
                AURA blocks are public records of AI-assisted content generation, including details like the model used,
                prompts, timestamps, and licenses.
            </p>
            <p>
                This search interface does not require an account.
                If you want to register and preserve your own blocks permanently, you can
                <a href="/register" class="text-aura-leather dark:text-aura-yellow hover:text-aura-green dark:hover:text-aura-cream">
                    create an account
                </a>.
            </p>
        </section>

        <section class="bg-aura-soft dark:bg-aura-deep p-6 rounded-2xl shadow border border-aura-olive dark:border-aura-gray">
            <h2 class="text-xl font-semibold text-aura-green dark:text-aura-yellow mb-4">Lookup by UID or Email</h2>

            <form id="blockForm" class="space-y-4">
                <label for="uidInput" class="block text-sm font-medium text-aura-gray dark:text-aura-cream">
                    Enter the block UID or your registered email:
                </label>
                <input
                        id="uidInput"
                        type="text"
                        placeholder="Example: AURA-2025-000001 or user@email.com"
                        class="w-full px-4 py-3 border border-aura-olive dark:border-aura-gray rounded-lg bg-white dark:bg-aura-deep text-aura-black dark:text-aura-cream focus:outline-none focus:ring-2 focus:ring-aura-green"
                />
                <button
                        type="submit"
                        class="w-full bg-aura-green dark:bg-aura-leather text-white px-6 py-3 rounded-lg hover:bg-aura-deep dark:hover:bg-aura-yellow transition text-lg font-semibold"
                >
                    üîç Search
                </button>
            </form>

            <div class="mt-6 text-sm text-aura-gray dark:text-aura-cream">
                <p>Example UID:
                    <code class="bg-gray-100 dark:bg-aura-deep px-2 py-1 rounded">AURA-2025-000001</code>
                </p>
                <p>Example Email:
                    <code class="bg-gray-100 dark:bg-aura-deep px-2 py-1 rounded">example@email.com</code>
                </p>
            </div>
        </section>
    </main>

    <!-- ‚úÖ Script adaptado para UID o Email -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("blockForm");
            const input = document.getElementById("uidInput");

            form.addEventListener("submit", (e) => {
                e.preventDefault();
                let value = input.value.trim(); // ‚ùå NO lo pasamos a lower, mantenemos may√∫sculas

                if (!value) {
                    alert("Please enter a UID or an Email.");
                    return;
                }

                // ‚úÖ Regex m√°s flexible: acepta 4 d√≠gitos de a√±o y de 1 a 10 d√≠gitos en el final
                const isUID = /^AURA-\d{4}-\d{1,10}$/.test(value);
                const isEmail = /^[A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i.test(value);

                if (isUID) {
                    window.location.href = `/block/${value}`;
                } else if (isEmail) {
                    window.location.href = `/blocks-by-email/${encodeURIComponent(value)}`;
                } else {
                    alert("Please enter a valid UID (AURA-YYYY-XXXXXX) or a valid Email.");
                }
            });
        });
    </script>

</Layout>
